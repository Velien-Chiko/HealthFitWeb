@model dynamic
@{
	ViewData["Title"] = "Cập Nhật Người Dùng";
}

<div class="container">
	<div class="row justify-content-center">
		<div class="col-md-8 col-lg-6">
			<div class="card">
				<div class="card-header text-center">
					<h3 class="mb-0">
						<i class="bi bi-person-gear"></i> @ViewData["Title"]
					</h3>
				</div>
				<div class="card-body">

@* ============================= *@
@* FORM CẬP NHẬT NGƯỜI DÙNG *@
@* Sửa thông tin cá nhân, vai trò, mật khẩu *@
@* ============================= *@
		<form asp-area="SystemAdmin" asp-controller="ManagerRole" asp-action="Update" method="post" id="updateUserForm">
			<input type="hidden" name="Id" value="@Model.Id" />
			<div asp-validation-summary="All" class="text-danger mb-3"></div>

			<div class="form-floating mb-3">
				<input type="email" class="form-control" id="email" name="email" value="@Model.Email" readonly>
				<label for="email">Email</label>
			</div>

			<div class="form-floating mb-3">
				<input type="text" class="form-control" id="fullName" name="fullName" value="@Model.FullName" placeholder="Nguyễn Văn A" required pattern="^[\p{L} ]+$" title="Họ và tên chỉ được phép nhập chữ cái và khoảng trắng, không chứa số hoặc ký tự đặc biệt.">
				<label for="fullName">Họ và Tên <span class="text-danger">*</span></label>
			</div>

			<div class="form-floating mb-3">
				<input type="text" class="form-control" id="address" name="address" value="@Model.Address" placeholder="Địa chỉ" required>
				<label for="address">Địa chỉ <span class="text-danger">*</span></label>
			</div>

			<div class="form-floating mb-3">
				<input type="text" class="form-control" id="city" name="city" value="@Model.City" placeholder="Thành phố" required>
				<label for="city">Thành phố <span class="text-danger">*</span></label>
			</div>

			<div class="form-floating mb-3">
				<input type="text" class="form-control" id="country" name="country" value="@Model.Country" placeholder="Quốc gia" required>
				<label for="country">Quốc gia <span class="text-danger">*</span></label>
			</div>

			<div class="form-floating mb-3">
				<input type="text" class="form-control" id="gender" name="gender" value="@Model.Gender" placeholder="Giới tính" required>
				<label for="gender">Giới tính <span class="text-danger">*</span></label>
			</div>

			<div class="form-floating mb-3">
				<input type="password" class="form-control" id="password" name="password" placeholder="Để trống nếu không đổi mật khẩu" minlength="6">
				<label for="password">Mật khẩu mới (không bắt buộc, ít nhất 6 ký tự nếu nhập)</label>
			</div>

			<div class="form-floating mb-4">
				<select class="form-select" id="role" name="role" required>
					<option value="">-- Chọn vai trò --</option>
					@foreach (var role in ViewBag.Roles)
					{
						<option value="@role" selected="@(role == Model.Role)">@role</option>
					}
				</select>
				<label for="role">Vai trò <span class="text-danger">*</span></label>
			</div>

			<div class="d-flex justify-content-center gap-2">
				<a asp-area="SystemAdmin" asp-controller="ManagerRole" asp-action="SystemAdmin" class="btn btn-secondary">
					<i class="bi bi-arrow-left"></i> Quay lại
				</a>
				<button type="submit" class="btn btn-primary">
					<i class="bi bi-save"></i> Lưu thay đổi
				</button>
			</div>
		</form>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		document.getElementById('updateUserForm').addEventListener('submit', function(e) {
			var password = document.getElementById('password').value;
			if (password && password.length < 6) {
				alert('Mật khẩu phải có ít nhất 6 ký tự!');
				e.preventDefault();
			}
		});
	</script>
}