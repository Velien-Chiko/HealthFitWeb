@using HealthFit.Models.DTO.Order
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@model OrderDto
@{
    ViewData["Title"] = "Chi tiết đơn hàng";
}

<div class="container-fluid p-4">
    <!-- Tiêu đề trang -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Chi tiết đơn hàng #@Model.OrderId</h1>
        <a href="javascript:history.back()" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
            <i class="fas fa-arrow-left fa-sm text-white-50"></i> Quay lại
        </a>
    </div>

    <div class="row">
        <!-- Thông tin đơn hàng -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Thông tin đơn hàng</h6>
                </div>
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-uppercase mb-1">Mã đơn hàng</div>
                            <div class="h5 mb-3 font-weight-bold text-gray-800">#@Model.OrderId</div>

                            <div class="text-xs font-weight-bold text-uppercase mb-1">Ngày đặt hàng</div>
                            <div class="h5 mb-3 font-weight-bold text-gray-800">@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</div>

                            <div class="text-xs font-weight-bold text-uppercase mb-1">Người bán</div>
                            <div class="h5 mb-3 font-weight-bold text-gray-800">@Model.SellerName</div>

                            <div class="text-xs font-weight-bold text-uppercase mb-1">Trạng thái</div>
                            <div class="h5 mb-3">
                                @{
                                    var statusClass = Model.Status switch
                                    {
                                        "Completed" => "badge badge-success",
                                        "Pending" => "badge badge-warning",
                                        "Cancelled" => "badge badge-danger",
                                        _ => "badge badge-secondary"
                                    };
                                }
                                <span class="@statusClass">@Model.Status</span>
                            </div>

                            <div class="text-xs font-weight-bold text-uppercase mb-1">Tổng tiền</div>
                            <div class="h5 mb-0 font-weight-bold text-primary">@Model.TotalAmount.ToString("N0") đ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danh sách sản phẩm -->
        <div class="col-xl-8 col-md-6 mb-4">
            @{
                bool hasCombo = Model.MealPlans != null && Model.MealPlans.Any();
            }
            @if (hasCombo)
            {
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Sản phẩm đã đặt</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>Số lượng</th>
                                        <th>Đơn giá</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var mealPlan in Model.MealPlans)
                                    {
                                        <tr>
                                            <td>@mealPlan.PlanDescription</td>
                                            <td>@mealPlan.Quantity</td>
                                            <td>@mealPlan.UnitPrice.ToString("N0") đ</td>
                                            <td>@mealPlan.Subtotal.ToString("N0") đ</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            else if (Model.Products != null && Model.Products.Any())
            {
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Sản phẩm đã đặt</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>Số lượng</th>
                                        <th>Đơn giá</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var product in Model.Products)
                                    {
                                        <tr>
                                            <td>@product.ProductName</td>
                                            <td>@product.Quantity</td>
                                            <td>@product.UnitPrice.ToString("N0") đ</td>
                                            <td>@product.Subtotal.ToString("N0") đ</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Sản phẩm đã đặt</h6>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">Không có sản phẩm nào trong đơn hàng</div>
                    </div>
                </div>
            }

            @if (Model.MealPlans != null && Model.MealPlans.Any())
            {
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Meal Plans đã đặt</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Meal Plan</th>
                                        <th>Số lượng</th>
                                        <th>Đơn giá</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var mealPlan in Model.MealPlans)
                                    {
                                        <tr>
                                            <td>@mealPlan.PlanDescription</td>
                                            <td>@mealPlan.Quantity</td>
                                            <td>@mealPlan.UnitPrice.ToString("N0") đ</td>
                                            <td>@mealPlan.Subtotal.ToString("N0") đ</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Có thể thêm các xử lý JavaScript nếu cần
        });
    </script>
}
